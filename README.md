# ASCT+B Generator

This program converts a simple TSV file into a HuBMAP ASCT+B table.

The included file "demo-input.txt" was generated by Excel using the "demo-input.xlsx" file (Save As "Tab delimited Text"). The generated output is a TSV file. The example file "demo-output.xls" was generated by the program.

## Version

**v1.0-beta** - Feb 11, 2022 - This is a complete rewrite of the program. This version has none of the limitations from the alpha version, it includes more data validation, and requires less user intervention. 

**v0.1-alpha** - Feb 2, 2022 - This is a proof of concept and not meant for production use.

## Differences 

These are the significant differences from the previous ("alpha") version.
  1. The command line arguments have been greatly simplified.
  2. Users no longer need to know the number of AS levels.
  3. **The input file has also changed with this release, with cells now listed in a separate column from the children column.**
  4. Biomarkers and references can now be allied to any anatomical structure.
  5. The program now requires the anytree Python module.
  6. The program will now autogenerate a header in the output file.

## Assumptions

The following assumptions are built into the program.
  1. The ASCT+B table format allows anatomical structures that are not "leaves" to contain biomarkers or references.
  2. All anatomical structures must be uniquely named, for example, there can not be two structures called "ovary" but there can be "left ovary" and "right ovary".
  3. Cell type is only one level.

## Data validation

The program performs the following data validation.
  1. make sure there's only one root anatomical structure
  2. make sure every anatomical structure has only one parent
  3. make sure no two anatomical structures, cells, biomarkers, or references have the same name

## Requirements

This program has only been tested on a Mac OS using Python 3. Although it should work on a Linux system.

The program requires the anytree Python package.
```
https://pypi.org/project/anytree/

```
The anytree package can be installed as follows.
```
python3 -m pip install anytree --user
```

## Usage

To process the demo input file and generate a TSV file that can be opened by Excel

```
process.py <input TSV file> <output TSV file>
```


```
process.py demo-input.txt demo-output.xls
```

## Input file (TSV)

The tab delimited file must contain a header line and the following twelve columns:

NAME (REF DOI)	LABEL (REF DETAILS)	ID (REF NOTES)	TYPE	CHILDREN	CELLS	GENES	PROTEINS	PROTEOFORMS	LIPIDS	METABOLITES	FTUs	REFERENCES

The **Type** value needs to be "AS" for anatomical structures and "CT" for cell types. It doesn't matter what type values are used for the other items, so long as it's not either AS or CT.

**Children** is a comma separated list of child anatomical structure (AS) objects. These children need to be either anatomical structures (AS). The **Cells**, **Genes**, **Proteins**, **Proteoforms**, etc fields should be comma separated lists of the appropriate objects (e.g., **Cells**, should be a comma separated list of relevant cells). In all cases the objects **Name** or **Ref DOI** should be used. 

The first line in the input file is assumed to contain a header and is ignored.

The following example is incomplete and just included to exemplify the field values and usage:

```
NAME (REF DOI)	LABEL (REF DETAILS)	ID (REF NOTES)	TYPE	CHILDREN	CELLS	GENES	PROTEINS	PROTEOFORMS	LIPIDS	METABOLITES	FTU	REFERENCES (NAME/DOI)
ovary		UBERON:0000992	AS	central ovary, lateral ovary, medial ovary, mesovarium, ovarian ligament	hilum of ovary
central ovary			AS	central inferior ovary, central superior ovary	
lateral ovary			AS	lateral inferior ovary, lateral superior ovary	
medial ovary			AS	medial inferior ovary, medial superior ovary	
mesovarium		UBERON:0001342	AS		
ovarian ligament		UBERON:0008847	AS		
hilum of ovary			AS	ovarian artery, ovarian vein, pampiniform plexus, rete ovarii	hilar cell
corona radiata		CL:0000713	CT									doi:10.1093/oxfordjournals.humrep.a136365
hilar cell		CL:0002095	CT				alkaline phosphatase, acid phosphatase, non-specific esterase, inhibin, calretinin, melan-A, cholesterol esters					McKay et al 1961, Boss et al 1965, Mills et al 2020, Jungbluth et al 1998, Pelkey et al 1998
mural granulosa cell			CT									doi:10.1093/oxfordjournals.humrep.a136365
primary oocyte		CL:0000654	CT									doi:10.1093/oxfordjournals.humrep.a136365
secondary oocyte		CL:0000655	CT									doi:10.1093/oxfordjournals.humrep.a136365
columnar ovarian surface epithelial columnar cell			CT				calretinin, mesothelin					Mills et al 2020, Reeves et al 1971, Hummitzsch et al 2013, Blaustein et al 1979, McKay et al 1961
flattened cuboidal ovarian surface epithelial cell			CT				oviduct-specific glycoprotein-1, E-cadherin					Mills et al 2020, Reeves et al 1971, Hummitzsch et al 2013, Blaustein et al 1979, McKay et al 1961
oviduct-specific glycoprotein-1			Protein									
mesothelin			Protein									
E-cadherin			Protein									
doi:10.1093/oxfordjournals.humrep.a136365	PMID: 3558758		Reference									
McKay et al 1961	McKay, D., Pinkerton, J., Hertig, A. & Danziger, S. (1961). The Adult Human Ovary: A Histochemical Study. Obstetrics & Gynecology, 18(1), 13-39. 		Reference									
```

## Known problems and limitations

1. The program should validate the biomarkers using the TYPE designation.
